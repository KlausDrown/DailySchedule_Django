<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Календарь планировщика</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 0;
            text-align: center;
        }
        
        .month-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .month-navigation {
            display: flex;
            gap: 10px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button.today-btn {
            background-color: #2ecc71;
        }
        
        button.today-btn:hover {
            background-color: #27ae60;
        }
        
        .current-month {
            font-size: 24px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #ddd;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .calendar-header {
            background-color: #3498db;
            color: white;
            text-align: center;
            padding: 12px 5px;
            font-weight: 600;
        }
        
        .calendar-day {
            background-color: white;
            padding: 10px;
            min-height: 100px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .calendar-day:hover {
            background-color: #f8f9fa;
        }
        
        .calendar-day.empty {
            background-color: #f9f9f9;
            cursor: default;
        }
        
        .calendar-day.empty:hover {
            background-color: #f9f9f9;
        }
        
        .day-number {
            font-weight: 600;
            color: #2c3e50;
            font-size: 16px;
            margin-bottom: 5px;
        }
        
        .calendar-day.today .day-number {
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
        }
        
        .calendar-day.weekend {
            background-color: #f8f9fa;
        }
        
        .calendar-day.weekend .day-number {
            color: #e74c3c;
        }
        
        .day-events {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .events-count {
            display: inline-block;
            background-color: #3498db;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 20px;
            font-size: 11px;
            margin-top: 5px;
        }
        
        .instructions {
            background-color: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #3498db;
            border-radius: 0 4px 4px 0;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .current-date {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            text-align: center;
            color: #7f8c8d;
        }
        
        @media (max-width: 768px) {
            .calendar {
                grid-template-columns: repeat(7, 1fr);
            }
            
            .calendar-day {
                min-height: 80px;
                padding: 5px;
            }
            
            .day-number {
                font-size: 14px;
            }
            
            .month-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .month-navigation {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Календарь планировщика</h1>
        
        <div class="month-header">
            <button id="prevMonth">← Предыдущий</button>
            <div class="current-month" id="currentMonth">Июль 2025</div>
            <div class="month-navigation">
                <button id="today" class="today-btn">Сегодня</button>
                <button id="nextMonth">Следующий →</button>
            </div>
        </div>
        
        <div class="calendar" id="calendar">
            <!-- Дни недели -->
            <div class="calendar-header">Пн</div>
            <div class="calendar-header">Вт</div>
            <div class="calendar-header">Ср</div>
            <div class="calendar-header">Чт</div>
            <div class="calendar-header">Пт</div>
            <div class="calendar-header">Сб</div>
            <div class="calendar-header">Вс</div>
            
            <!-- Дни месяца будут добавлены через JavaScript -->
        </div>
        
        <div class="instructions">
            <p><strong>Как использовать:</strong> Кликните на любой день месяца, чтобы открыть планировщик на выбранную дату. Текущий день выделен синим кружком.</p>
            <p><strong>Сохранение данных:</strong> Все задачи сохраняются в браузере и привязаны к конкретным датам.</p>
        </div>
        
        <div class="current-date">
            <div>Текущая дата: <span id="currentDate">26.07.2025</span></div>
            <div>Выбранная дата: <span id="selectedDate">-</span></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calendar = document.getElementById('calendar');
            const currentMonthElement = document.getElementById('currentMonth');
            const prevMonthBtn = document.getElementById('prevMonth');
            const nextMonthBtn = document.getElementById('nextMonth');
            const todayBtn = document.getElementById('today');
            const currentDateElement = document.getElementById('currentDate');
            const selectedDateElement = document.getElementById('selectedDate');
            
            let currentDate = new Date();
            let selectedDate = new Date();
            
            // Названия месяцев
            const monthNames = [
                'Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь',
                'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'
            ];
            
            // Сокращенные названия месяцев для даты
            const monthNamesShort = [
                'янв', 'фев', 'мар', 'апр', 'май', 'июн',
                'июл', 'авг', 'сен', 'окт', 'ноя', 'дек'
            ];
            
            // Дни недели
            const dayNames = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];
            
            // Инициализация текущей даты
            function updateCurrentDate() {
                const now = new Date();
                currentDateElement.textContent = formatDate(now);
            }
            
            // Форматирование даты в формат день.мес.год
            function formatDate(date) {
                const day = date.getDate();
                const month = date.getMonth() + 1;
                const year = date.getFullYear();
                return `${day}.${month}.${year}`;
            }
            
            // Форматирование даты для URL (день-мес-год)
            function formatDateForURL(date) {
                const day = date.getDate();
                const month = date.getMonth() + 1;
                const year = date.getFullYear().toString().slice(-2);
                return `${day}-${month}-${year}`;
            }
            
            // Генерация календаря на месяц
            function generateCalendar() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                
                // Обновляем заголовок месяца
                currentMonthElement.textContent = `${monthNames[month]} ${year}`;
                
                // Очищаем календарь (удаляем все дни, кроме заголовков дней недели)
                while (calendar.children.length > 7) {
                    calendar.removeChild(calendar.lastChild);
                }
                
                // Первый день месяца
                const firstDay = new Date(year, month, 1);
                // Последний день месяца
                const lastDay = new Date(year, month + 1, 0);
                
                // День недели первого дня месяца (0 - воскресенье, 1 - понедельник и т.д.)
                // Наша неделя начинается с понедельника, поэтому корректируем
                let firstDayIndex = firstDay.getDay();
                if (firstDayIndex === 0) firstDayIndex = 6; // Воскресенье -> 6
                else firstDayIndex--; // Понедельник -> 0, Вторник -> 1 и т.д.
                
                // Пустые ячейки перед первым днем месяца
                for (let i = 0; i < firstDayIndex; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day empty';
                    calendar.appendChild(emptyDay);
                }
                
                // Загружаем сохраненные задачи для всех дней месяца
                const monthEvents = loadMonthEvents(year, month + 1);
                
                // Дни месяца
                for (let day = 1; day <= lastDay.getDate(); day++) {
                    const dayDate = new Date(year, month, day);
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    
                    // Проверяем, является ли день выходным (суббота или воскресенье)
                    const dayOfWeek = dayDate.getDay();
                    if (dayOfWeek === 0 || dayOfWeek === 6) {
                        dayElement.classList.add('weekend');
                    }
                    
                    // Проверяем, является ли день сегодняшним
                    const today = new Date();
                    if (dayDate.getDate() === today.getDate() && 
                        dayDate.getMonth() === today.getMonth() && 
                        dayDate.getFullYear() === today.getFullYear()) {
                        dayElement.classList.add('today');
                    }
                    
                    // Проверяем, является ли день выбранным
                    if (dayDate.getDate() === selectedDate.getDate() && 
                        dayDate.getMonth() === selectedDate.getMonth() && 
                        dayDate.getFullYear() === selectedDate.getFullYear()) {
                        dayElement.style.backgroundColor = '#e8f4fc';
                        dayElement.style.borderLeft = '4px solid #3498db';
                    }
                    
                    // Добавляем номер дня
                    const dayNumber = document.createElement('div');
                    dayNumber.className = 'day-number';
                    dayNumber.textContent = day;
                    dayElement.appendChild(dayNumber);
                    
                    // Добавляем информацию о событиях
                    const eventsInfo = document.createElement('div');
                    eventsInfo.className = 'day-events';
                    
                    const dateKey = `${day}.${month + 1}.${year}`;
                    if (monthEvents[dateKey] && monthEvents[dateKey] > 0) {
                        const eventsCount = document.createElement('span');
                        eventsCount.className = 'events-count';
                        eventsCount.textContent = monthEvents[dateKey];
                        eventsInfo.appendChild(eventsCount);
                    }
                    
                    dayElement.appendChild(eventsInfo);
                    
                    // Обработчик клика на день
                    dayElement.addEventListener('click', function() {
                        selectedDate = new Date(year, month, day);
                        selectedDateElement.textContent = formatDate(selectedDate);
                        
                        // Перенаправляем на страницу планировщика с выбранной датой
                        const urlDate = formatDateForURL(selectedDate);
                        window.location.href = `${urlDate}.html`;
                    });
                    
                    calendar.appendChild(dayElement);
                }
            }
            
            // Загрузка событий за месяц
            function loadMonthEvents(year, month) {
                const events = {};
                
                // Проходим по всем сохраненным данным в localStorage
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    
                    // Проверяем, является ли ключ данными расписания
                    if (key.startsWith('timeScheduleData_')) {
                        try {
                            const data = JSON.parse(localStorage.getItem(key));
                            const dateStr = key.replace('timeScheduleData_', '');
                            
                            // Парсим дату из ключа (формат: день-мес-год)
                            const parts = dateStr.split('-');
                            if (parts.length === 3) {
                                const day = parseInt(parts[0]);
                                const monthFromKey = parseInt(parts[1]);
                                const yearFromKey = 2000 + parseInt(parts[2]);
                                
                                // Проверяем, относится ли дата к текущему месяцу
                                if (yearFromKey === year && monthFromKey === month) {
                                    const dateKey = `${day}.${monthFromKey}.${yearFromKey}`;
                                    events[dateKey] = data.tasks ? data.tasks.length : 0;
                                }
                            }
                        } catch (e) {
                            console.error('Ошибка загрузки данных для календаря:', e);
                        }
                    }
                }
                
                return events;
            }
            
            // Переход к предыдущему месяцу
            prevMonthBtn.addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                generateCalendar();
            });
            
            // Переход к следующему месяцу
            nextMonthBtn.addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                generateCalendar();
            });
            
            // Переход к текущему месяцу
            todayBtn.addEventListener('click', function() {
                currentDate = new Date();
                selectedDate = new Date();
                selectedDateElement.textContent = formatDate(selectedDate);
                generateCalendar();
            });
            
            // Инициализация
            updateCurrentDate();
            selectedDateElement.textContent = formatDate(selectedDate);
            generateCalendar();
            
            // Обработчик для получения даты из текущего URL
            function getDateFromURL() {
                // Получаем путь из URL (например: /31-12-26.html)
                const path = window.location.pathname;
                const fileName = path.split('/').pop();
                
                // Проверяем, соответствует ли имя файла формату даты
                const dateRegex = /^(\d{1,2})-(\d{1,2})-(\d{2})\.html$/;
                const match = fileName.match(dateRegex);
                
                if (match) {
                    const day = parseInt(match[1]);
                    const month = parseInt(match[2]) - 1;
                    const year = 2000 + parseInt(match[3]);
                    
                    return new Date(year, month, day);
                }
                
                return null;
            }
            
            // Если мы на странице с датой, обновляем выбранную дату
            const urlDate = getDateFromURL();
            if (urlDate) {
                selectedDate = urlDate;
                selectedDateElement.textContent = formatDate(selectedDate);
                
                // Также устанавливаем текущий месяц на месяц из даты
                currentDate = new Date(urlDate.getFullYear(), urlDate.getMonth(), 1);
                generateCalendar();
            }
        });
    </script>
</body>
</html>